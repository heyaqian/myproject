<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Document</title>
    <link rel="stylesheet" href="css/register.css">
    <link rel="stylesheet" href="css/public.css">
</head>
<body>
    <div class="content_body">
        <div class="t">注册会员</div>
        <form action="">
          <table border="0" cellpadding="0" cellspacing="0">
            <tbody>
                <tr> 
                    <th>用户名：</th>              
                    <td><input name="username" type="text" size="25" id="user" placeholder="请输入用户名或手机号">
                    <span id="username"> *</span>
                    </td>
                </tr>
                <tr>
                    <th>邮箱:</th>              
                    <td>
                        <input name="email" type="text" size="25" id="email" >
                        <span id="email_notice"> *</span>                      
                    </td>
                </tr>
                <tr>
                    <th>密码：</th>                
                    <td>
                        <input name="password" type="password" id="pass" >
                        <span id="password_notice"> *</span>
                    </td>
                </tr>
            <tr>
              <th>确认密码 :</th>               
              <td>
                  <input name="confirm_password" type="password" id="repass">
                  <span id="conform_password_notice"> *</span>
              </td>
            </tr>
            <tr>
              <th>手机 :</th>               
              <td>
                  <input name="tel" type="tel" id="tel">
                  <span id="tel_notice"> *</span>
              </td>
            </tr>
            <tr>
                <th></th>
                <td>
                    <label class="checked">
                    <input name="agreement" type="checkbox" value="1" checked="checked" class="checked">
                    我已看过并接受《<a  style="color:blue" target="_blank">用户协议</a>》</label>
                </td>
              </tr>
              <tr>
                    <th></th>
                    <td>
                        <input value="同意协议并注册" name="Submit" class="agree" type="submit" id="register"><span id=""> </span>
                    </td>
              </tr>           
          </tbody>
        </table>
    </form>
    <div class="want_login"> 我已有账号，我要登录<a href="login.html"  class="loginnow">马上登录</a>!</div>
      </div>

      <div class="footer-b">
            Copyright ©2007 - 2017 湖北知音动漫有限公司版权所有 <br>
            网址：www.zymkshop.com 备案号：鄂ICP备17018280号<br>
            <div style="width:300px;margin:0 auto; padding:20px 0;">
                <a target="_blank" href="http://www.beian.gov.cn/portal/registerSystemInfo?recordcode=42010602003555" style="display:inline-block;text-decoration:none;height:20px;line-height:20px;"><img src="images/beian.png" style="float:left;"><p style="float:left;height:20px;line-height:20px;margin: 0px 0px 0px 5px; color:#939393;">鄂公网安备 42010602003555号</p></a>
            </div><a href="https://m.kuaidi100.com/" target="_blank">快递查询</a>
    </div>
</body>
<script>
class register{
    constructor(){        
        this.email=document.getElementById("email");
        this.user=document.getElementById("user");
        this.pass=document.getElementById("pass");
        this.repass=document.getElementById("repass");
        this.register=document.getElementById("register");
        this.tel=document.getElementById("tel")
        // this.n=this.b=this.s=0;   
        this.addEvent();
    }
    addEvent(){
        var that=this;
        that.user.oninput = function(){
            console.log(1);           
        var reg = /^[\u2E80-\u9FFF\w\-]{4,20}$/;
        if(reg.test(that.user.value)){
            that.user.nextElementSibling.innerHTML = "用户名正确";
            // u = true;
        }else{
            that.user.nextElementSibling.innerHTML = "用户名不正确";
            // u = false;
            }
        }
        
        that.pass.oninput=function(){
            var reg=/\d/;
            var reg1=/[a-z]/i;
            var reg2=/[^\da-z]/i;       
            if(reg.test(that.pass.value)){
                that.n=1;
            }    
            if(reg1.test(that.pass.value)){
                that.s=1;
            }    
            if(reg2.test(that.pass.value)){
                that.b=1;
            }    
            switch(that.n+that.s+that.b){
            case 1:that.pass.nextElementSibling.innerHTML="简单"; break;
            case 2:that.pass.nextElementSibling.innerHTML="一般";break;
            case 3:that.pass.nextElementSibling.innerHTML="困难";break;
            }
            if(that.repass.value == "") return;
        if(that.pass.value == that.repass.value){
            that.repass.nextElementSibling.innerHTML = "一致";
            // p2 = true;
        }else{
            that.repass.nextElementSibling.innerHTML = "不一致";
            // p2 = false;
        }
    }
    this.repass.oninput = function(){
        if(that.pass.value == that.repass.value){
            that.repass.nextElementSibling.innerHTML = "一致";
            // p2 = true;
        }else{
            that.repass.nextElementSibling.innerHTML = "不一致";
            // p2 = false;
        }
    }
    this.email.oninput=function(){
        //邮箱：数字字母开头，中间可以多个数字字母下划线“-”；
        //2.中间@加数字或字母；3，“.”加数字或字母；
        // var reg=/^(\+86)?1\d{10}$/;
    var reg=/^[\da-zA-Z][\w-]+@[\da-z]+\.[\da-z]+$/;
    if(reg.test(this.value)){
        this.nextElementSibling.innerHTML="正确";
        // e=1;
    }else{
        this.nextElementSibling.innerHTML="不正确";
        }
    }   
    this.tel.oninput=function(){
        var reg=/^(\+86)?1\d{10}$/;
    if(reg.test(this.value)){
        this.nextElementSibling.innerHTML="正确";
        // e=1;
    }else{
        this.nextElementSibling.innerHTML="不正确";
        }
    }   
        this.register.onclick=function(){
            that.u=that.user.value;
            that.p=that.pass.value;
            that.setMsg();
            // console.log(1);
        }
    }
    setMsg(){
        var that=this;
            ajaxPost("http://127.0.0.1:82/api",function(res){
                that.res=JSON.parse(res);
                console.log(that.res);
                that.span.innerHTML=that.res.msg;
            },{
                type:"register",
                user:this.u,
                pass:this.p
            })
                }
            }
            
            new register;      	
            function ajaxPost(url,cb,data){
                var str = "";
                for(var i in data){
                    str += `${i}=${data[i]}&`;
                }
                str = str.slice(0,str.length-1)
                var ajax = new XMLHttpRequest();
                ajax.open("post",url,true);
                ajax.onreadystatechange = function(){
                    if(ajax.readyState === 4 && ajax.status === 200){
                        cb(ajax.responseText);
                    }
                }
                ajax.setRequestHeader("Content-Type","application/x-www-form-urlencoded");
                ajax.send(str);
            }
            
</script>
</html>